name: Report

on:
  workflow_call:
    inputs:
      run_e2e:
        type: string
        default: "false"

jobs:
  report:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      actions: read
      contents: read

    steps:
      - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4.3.1

      - uses: actions/download-artifact@d3f86a106a0bac45b974a628896c90dbdf5c8093 # v4.3.0
        with:
          pattern: report-*
          merge-multiple: true
          path: artifacts

      - uses: actions/setup-python@a26af69be951a213d495a4c3e4e4022e16d87065 # v5.6.0
        with:
          python-version: "3.14"

      - name: Generate Report
        run: python .github/scripts/generate_report.py
        env:
          RUN_E2E: ${{ inputs.run_e2e }}

      - name: Publish Summary
        run: cat report.md >> $GITHUB_STEP_SUMMARY

      - uses: marocchino/sticky-pull-request-comment@773744901bac0e8cbb5a0dc842800d45e9b2b405 # v2.9.4
        if: github.event_name == 'pull_request'
        with:
          path: report.md
          header: naur-ci-report

      - uses: Kesin11/actions-timeline@7c7e0821d38f27460f4a71ef874a1c8cf23602e4 # v2.2.6
